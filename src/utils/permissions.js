// Sistema de Permiss√µes Granular - EXPANS√ÉO COMPLETA
export const PERMISSIONS = {
  // Dashboard
  DASHBOARD_VIEW: 'dashboard.view',
  DASHBOARD_ALL_UNITS: 'dashboard.all_units',
  
  // Mensagens WhatsApp
  MESSAGES_ACCESS: 'messages.access',
  MESSAGES_SEND: 'messages.send',
  MESSAGES_HISTORY: 'messages.history',
  MESSAGES_MANAGE_TEMPLATES: 'messages.manage_templates', // ADMIN ONLY
  
  // Contas BTG
  BTG_ACCESS: 'btg.access',
  BTG_CREATE: 'btg.create',
  BTG_EDIT: 'btg.edit',
  BTG_DELETE: 'btg.delete',
  BTG_VIEW_ALL: 'btg.view_all', // Ver contas de outros usu√°rios
  BTG_VIEW_OWN: 'btg.view_own', // Ver apenas pr√≥prias contas
  
  // Cobran√ßas/Hist√≥rico
  CHARGES_ACCESS: 'charges.access',
  CHARGES_CREATE: 'charges.create',
  CHARGES_EDIT: 'charges.edit',
  CHARGES_DELETE: 'charges.delete', // ADMIN ONLY
  CHARGES_MANAGE_PAYMENTS: 'charges.manage_payments',
  CHARGES_VIEW_DELETED: 'charges.view_deleted',
  
  // Extratos/Lan√ßamentos
  EXTRACTS_ACCESS: 'extracts.access',
  EXTRACTS_CREATE: 'extracts.create',
  EXTRACTS_EDIT: 'extracts.edit',
  EXTRACTS_DELETE: 'extracts.delete',
  EXTRACTS_EXPORT: 'extracts.export',
  EXTRACTS_ALL_UNITS: 'extracts.all_units',
  EXTRACTS_VIEW_ALL: 'extracts.view_all', // Ver lan√ßamentos de todos
  EXTRACTS_VIEW_OWN: 'extracts.view_own', // Ver apenas pr√≥prios lan√ßamentos
  
  // Folha de Pagamento (ADMIN ONLY)
  PAYROLL_ACCESS: 'payroll.access',
  PAYROLL_CREATE: 'payroll.create',
  PAYROLL_EDIT: 'payroll.edit',
  PAYROLL_DELETE: 'payroll.delete',
  PAYROLL_EXPORT: 'payroll.export',
  
  // Configura√ß√µes Sistema
  SETTINGS_ACCESS: 'settings.access',
  SETTINGS_SHEETS: 'settings.sheets', // ADMIN ONLY
  SETTINGS_SYSTEM: 'settings.system', // ADMIN ONLY
  SETTINGS_PROFILE: 'settings.profile', // Pr√≥prio perfil
  
  // Gerenciamento de Usu√°rios (ADMIN ONLY)
  USERS_ACCESS: 'users.access',
  USERS_CREATE: 'users.create',
  USERS_EDIT: 'users.edit',
  USERS_DELETE: 'users.delete',
  USERS_MANAGE_PERMISSIONS: 'users.manage_permissions',
  
  // Gest√£o de Contas Geral (ADMIN ONLY)
  ACCOUNTS_MANAGEMENT_ACCESS: 'accounts.management.access',
  ACCOUNTS_MANAGEMENT_ALL: 'accounts.management.all',
  
  // Cadastros R√°pidos
  QUICK_REGISTRATION_ACCESS: 'quick_registration.access',
  QUICK_REGISTRATION_EMPLOYEES: 'quick_registration.employees',
  QUICK_REGISTRATION_VILA_PROGRESSO: 'quick_registration.vila_progresso'
};

// Grupos de permiss√µes organizados por m√≥dulo
export const PERMISSION_GROUPS = {
  dashboard: {
    name: 'üìä Dashboard',
    description: 'Vis√£o geral e m√©tricas do sistema',
    adminOnly: false,
    permissions: [
      PERMISSIONS.DASHBOARD_VIEW,
      PERMISSIONS.DASHBOARD_ALL_UNITS
    ]
  },
  messages: {
    name: 'üí¨ Mensagens WhatsApp',
    description: 'Envio e hist√≥rico de mensagens autom√°ticas',
    adminOnly: false,
    permissions: [
      PERMISSIONS.MESSAGES_ACCESS,
      PERMISSIONS.MESSAGES_SEND,
      PERMISSIONS.MESSAGES_HISTORY,
      PERMISSIONS.MESSAGES_MANAGE_TEMPLATES
    ]
  },
  btg_accounts: {
    name: 'üè¶ Contas BTG',
    description: 'Cadastro e gest√£o de contas BTG (Boleto/PIX)',
    adminOnly: false,
    permissions: [
      PERMISSIONS.BTG_ACCESS,
      PERMISSIONS.BTG_CREATE,
      PERMISSIONS.BTG_EDIT,
      PERMISSIONS.BTG_DELETE,
      PERMISSIONS.BTG_VIEW_ALL,
      PERMISSIONS.BTG_VIEW_OWN
    ]
  },
  charges: {
    name: 'üí∞ Hist√≥rico de Cobran√ßas',
    description: 'Gest√£o completa de pagamentos e cobran√ßas',
    adminOnly: false,
    permissions: [
      PERMISSIONS.CHARGES_ACCESS,
      PERMISSIONS.CHARGES_CREATE,
      PERMISSIONS.CHARGES_EDIT,
      PERMISSIONS.CHARGES_DELETE,
      PERMISSIONS.CHARGES_MANAGE_PAYMENTS,
      PERMISSIONS.CHARGES_VIEW_DELETED
    ]
  },
  extracts: {
    name: 'üìà Extratos e Lan√ßamentos',
    description: 'Relat√≥rios financeiros e lan√ßamentos cont√°beis',
    adminOnly: false,
    permissions: [
      PERMISSIONS.EXTRACTS_ACCESS,
      PERMISSIONS.EXTRACTS_CREATE,
      PERMISSIONS.EXTRACTS_EDIT,
      PERMISSIONS.EXTRACTS_DELETE,
      PERMISSIONS.EXTRACTS_EXPORT,
      PERMISSIONS.EXTRACTS_ALL_UNITS,
      PERMISSIONS.EXTRACTS_VIEW_ALL,
      PERMISSIONS.EXTRACTS_VIEW_OWN
    ]
  },
  payroll: {
    name: 'üíº Folha de Pagamento',
    description: 'Gest√£o completa da folha de pagamento',
    adminOnly: true,
    permissions: [
      PERMISSIONS.PAYROLL_ACCESS,
      PERMISSIONS.PAYROLL_CREATE,
      PERMISSIONS.PAYROLL_EDIT,
      PERMISSIONS.PAYROLL_DELETE,
      PERMISSIONS.PAYROLL_EXPORT
    ]
  },
  quick_registration: {
    name: '‚ö° Cadastros R√°pidos',
    description: 'Cadastros r√°pidos de funcion√°rios e alunos',
    adminOnly: false,
    permissions: [
      PERMISSIONS.QUICK_REGISTRATION_ACCESS,
      PERMISSIONS.QUICK_REGISTRATION_EMPLOYEES,
      PERMISSIONS.QUICK_REGISTRATION_VILA_PROGRESSO
    ]
  },
  accounts_management: {
    name: 'üèõÔ∏è Gest√£o de Contas Geral',
    description: 'Vis√£o administrativa de todas as contas financeiras',
    adminOnly: true,
    permissions: [
      PERMISSIONS.ACCOUNTS_MANAGEMENT_ACCESS,
      PERMISSIONS.ACCOUNTS_MANAGEMENT_ALL
    ]
  },
  settings: {
    name: '‚öôÔ∏è Configura√ß√µes',
    description: 'Configura√ß√µes do sistema e integra√ß√µes',
    adminOnly: false,
    permissions: [
      PERMISSIONS.SETTINGS_ACCESS,
      PERMISSIONS.SETTINGS_SHEETS,
      PERMISSIONS.SETTINGS_SYSTEM,
      PERMISSIONS.SETTINGS_PROFILE
    ]
  },
  users: {
    name: 'üë• Gerenciar Usu√°rios',
    description: 'Cria√ß√£o e gest√£o de usu√°rios do sistema',
    adminOnly: true,
    permissions: [
      PERMISSIONS.USERS_ACCESS,
      PERMISSIONS.USERS_CREATE,
      PERMISSIONS.USERS_EDIT,
      PERMISSIONS.USERS_DELETE,
      PERMISSIONS.USERS_MANAGE_PERMISSIONS
    ]
  }
};

// Perfis padr√£o com permiss√µes baseados nos requisitos
export const DEFAULT_PROFILES = {
  admin: {
    name: 'Administrador',
    permissions: Object.values(PERMISSIONS) // Todas as permiss√µes
  },
  
  // NOVO PERFIL TESTE - Para as meninas (vers√£o de teste)
  teste: {
    name: 'Usu√°rio Teste',
    description: 'Perfil para vers√£o de teste - acesso limitado conforme solicitado',
    permissions: [
      // Dashboard b√°sico
      PERMISSIONS.DASHBOARD_VIEW,
      
      // Mensagens (enviar mensagem e hist√≥rico)
      PERMISSIONS.MESSAGES_ACCESS,
      PERMISSIONS.MESSAGES_SEND,
      PERMISSIONS.MESSAGES_HISTORY,
      
      // Contas BTG (apenas cadastrar e gest√£o das pr√≥prias contas)
      PERMISSIONS.BTG_ACCESS,
      PERMISSIONS.BTG_CREATE,
      PERMISSIONS.BTG_VIEW_OWN, // Apenas contas registradas por ela
      
      // Cobran√ßas (apenas registrar e hist√≥rico dos pr√≥prios registros)
      PERMISSIONS.CHARGES_ACCESS,
      PERMISSIONS.CHARGES_CREATE,
      PERMISSIONS.CHARGES_VIEW_OWN, // Apenas cobran√ßas registradas por ela
      
      // Extratos (apenas visualizar)
      PERMISSIONS.EXTRACTS_ACCESS,
      PERMISSIONS.EXTRACTS_VIEW_OWN, // Apenas pr√≥prios lan√ßamentos
      
      // Configura√ß√µes b√°sicas (apenas perfil pr√≥prio)
      PERMISSIONS.SETTINGS_ACCESS,
      PERMISSIONS.SETTINGS_PROFILE
    ]
  },
  
  manager: {
    name: 'Gerente',
    permissions: [
      // Dashboard completo
      PERMISSIONS.DASHBOARD_VIEW,
      PERMISSIONS.DASHBOARD_ALL_UNITS,
      
      // Mensagens (sem gerenciar templates)
      PERMISSIONS.MESSAGES_ACCESS,
      PERMISSIONS.MESSAGES_SEND,
      PERMISSIONS.MESSAGES_HISTORY,
      
      // Contas BTG (ver todas)
      PERMISSIONS.BTG_ACCESS,
      PERMISSIONS.BTG_CREATE,
      PERMISSIONS.BTG_EDIT,
      PERMISSIONS.BTG_VIEW_ALL,
      
      // Cobran√ßas (sem excluir)
      PERMISSIONS.CHARGES_ACCESS,
      PERMISSIONS.CHARGES_CREATE,
      PERMISSIONS.CHARGES_EDIT,
      PERMISSIONS.CHARGES_MANAGE_PAYMENTS,
      
      // Extratos (ver todos)
      PERMISSIONS.EXTRACTS_ACCESS,
      PERMISSIONS.EXTRACTS_CREATE,
      PERMISSIONS.EXTRACTS_EDIT,
      PERMISSIONS.EXTRACTS_EXPORT,
      PERMISSIONS.EXTRACTS_ALL_UNITS,
      PERMISSIONS.EXTRACTS_VIEW_ALL,
      
      // Cadastros r√°pidos
      PERMISSIONS.QUICK_REGISTRATION_ACCESS,
      PERMISSIONS.QUICK_REGISTRATION_EMPLOYEES,
      PERMISSIONS.QUICK_REGISTRATION_VILA_PROGRESSO,
      
      // Configura√ß√µes b√°sicas
      PERMISSIONS.SETTINGS_ACCESS,
      PERMISSIONS.SETTINGS_PROFILE
    ]
  },
  
  operator: {
    name: 'Operador',
    permissions: [
      // Dashboard b√°sico
      PERMISSIONS.DASHBOARD_VIEW,
      
      // Mensagens b√°sicas
      PERMISSIONS.MESSAGES_ACCESS,
      PERMISSIONS.MESSAGES_SEND,
      PERMISSIONS.MESSAGES_HISTORY,
      
      // Contas BTG (apenas pr√≥prias)
      PERMISSIONS.BTG_ACCESS,
      PERMISSIONS.BTG_CREATE,
      PERMISSIONS.BTG_VIEW_OWN,
      
      // Cobran√ßas (apenas pr√≥prias)
      PERMISSIONS.CHARGES_ACCESS,
      PERMISSIONS.CHARGES_CREATE,
      PERMISSIONS.CHARGES_VIEW_OWN,
      
      // Extratos (apenas pr√≥prios)
      PERMISSIONS.EXTRACTS_ACCESS,
      PERMISSIONS.EXTRACTS_VIEW_OWN,
      
      // Configura√ß√µes b√°sicas
      PERMISSIONS.SETTINGS_ACCESS,
      PERMISSIONS.SETTINGS_PROFILE
    ]
  },
  
  viewer: {
    name: 'Visualizador',
    permissions: [
      // Apenas visualiza√ß√£o
      PERMISSIONS.DASHBOARD_VIEW,
      PERMISSIONS.MESSAGES_HISTORY,
      PERMISSIONS.BTG_VIEW_OWN,
      PERMISSIONS.CHARGES_VIEW_OWN,
      PERMISSIONS.EXTRACTS_VIEW_OWN,
      PERMISSIONS.SETTINGS_PROFILE
    ]
  }
};

// Descri√ß√µes detalhadas de cada permiss√£o
export const PERMISSION_DESCRIPTIONS = {
  // Dashboard
  [PERMISSIONS.DASHBOARD_VIEW]: 'Visualizar dashboard b√°sico',
  [PERMISSIONS.DASHBOARD_ALL_UNITS]: 'Ver dados de todas as unidades (n√£o apenas as pr√≥prias)',
  
  // Mensagens WhatsApp
  [PERMISSIONS.MESSAGES_ACCESS]: 'Acessar m√≥dulo de mensagens',
  [PERMISSIONS.MESSAGES_SEND]: 'Enviar mensagens WhatsApp',
  [PERMISSIONS.MESSAGES_HISTORY]: 'Ver hist√≥rico de mensagens enviadas',
  [PERMISSIONS.MESSAGES_MANAGE_TEMPLATES]: 'üîí ADMIN: Gerenciar modelos de mensagem',
  
  // Contas BTG
  [PERMISSIONS.BTG_ACCESS]: 'Acessar m√≥dulo de contas BTG',
  [PERMISSIONS.BTG_CREATE]: 'Cadastrar novas contas BTG',
  [PERMISSIONS.BTG_EDIT]: 'Editar contas BTG existentes',
  [PERMISSIONS.BTG_DELETE]: 'Excluir contas BTG',
  [PERMISSIONS.BTG_VIEW_ALL]: 'Ver contas BTG de todos os usu√°rios',
  [PERMISSIONS.BTG_VIEW_OWN]: 'Ver apenas as pr√≥prias contas BTG cadastradas',
  
  // Cobran√ßas
  [PERMISSIONS.CHARGES_ACCESS]: 'Acessar hist√≥rico de cobran√ßas',
  [PERMISSIONS.CHARGES_CREATE]: 'Gerar novas cobran√ßas',
  [PERMISSIONS.CHARGES_EDIT]: 'Editar cobran√ßas existentes',
  [PERMISSIONS.CHARGES_DELETE]: 'üîí ADMIN: Excluir/cancelar cobran√ßas',
  [PERMISSIONS.CHARGES_MANAGE_PAYMENTS]: 'Gerenciar status de pagamentos',
  [PERMISSIONS.CHARGES_VIEW_DELETED]: 'Visualizar cobran√ßas exclu√≠das',
  
  // Extratos
  [PERMISSIONS.EXTRACTS_ACCESS]: 'Acessar m√≥dulo de extratos',
  [PERMISSIONS.EXTRACTS_CREATE]: 'Criar novos lan√ßamentos',
  [PERMISSIONS.EXTRACTS_EDIT]: 'Editar lan√ßamentos existentes',
  [PERMISSIONS.EXTRACTS_DELETE]: 'Excluir lan√ßamentos',
  [PERMISSIONS.EXTRACTS_EXPORT]: 'Exportar relat√≥rios financeiros',
  [PERMISSIONS.EXTRACTS_ALL_UNITS]: 'Ver extratos de todas as unidades',
  [PERMISSIONS.EXTRACTS_VIEW_ALL]: 'Ver lan√ßamentos de todos os usu√°rios',
  [PERMISSIONS.EXTRACTS_VIEW_OWN]: 'Ver apenas os pr√≥prios lan√ßamentos criados',
  
  // Folha de Pagamento
  [PERMISSIONS.PAYROLL_ACCESS]: 'üîí ADMIN: Acessar folha de pagamento',
  [PERMISSIONS.PAYROLL_CREATE]: 'üîí ADMIN: Criar folhas de pagamento',
  [PERMISSIONS.PAYROLL_EDIT]: 'üîí ADMIN: Editar folhas de pagamento',
  [PERMISSIONS.PAYROLL_DELETE]: 'üîí ADMIN: Excluir folhas de pagamento',
  [PERMISSIONS.PAYROLL_EXPORT]: 'üîí ADMIN: Exportar relat√≥rios de folha',
  
  // Cadastros R√°pidos
  [PERMISSIONS.QUICK_REGISTRATION_ACCESS]: 'Acessar cadastros r√°pidos',
  [PERMISSIONS.QUICK_REGISTRATION_EMPLOYEES]: 'Cadastro r√°pido de funcion√°rios',
  [PERMISSIONS.QUICK_REGISTRATION_VILA_PROGRESSO]: 'Cadastro r√°pido Vila Progresso',
  
  // Gest√£o de Contas
  [PERMISSIONS.ACCOUNTS_MANAGEMENT_ACCESS]: 'üîí ADMIN: Acessar gest√£o de contas geral',
  [PERMISSIONS.ACCOUNTS_MANAGEMENT_ALL]: 'üîí ADMIN: Ver todos os lan√ßamentos financeiros',
  
  // Configura√ß√µes
  [PERMISSIONS.SETTINGS_ACCESS]: 'Acessar configura√ß√µes b√°sicas',
  [PERMISSIONS.SETTINGS_SHEETS]: 'üîí ADMIN: Configurar integra√ß√£o Google Sheets',
  [PERMISSIONS.SETTINGS_SYSTEM]: 'üîí ADMIN: Configura√ß√µes avan√ßadas do sistema',
  [PERMISSIONS.SETTINGS_PROFILE]: 'Editar pr√≥prio perfil',
  
  // Usu√°rios
  [PERMISSIONS.USERS_ACCESS]: 'üîí ADMIN: Acessar gerenciamento de usu√°rios',
  [PERMISSIONS.USERS_CREATE]: 'üîí ADMIN: Criar novos usu√°rios',
  [PERMISSIONS.USERS_EDIT]: 'üîí ADMIN: Editar usu√°rios existentes',
  [PERMISSIONS.USERS_DELETE]: 'üîí ADMIN: Excluir usu√°rios',
  [PERMISSIONS.USERS_MANAGE_PERMISSIONS]: 'üîí ADMIN: Gerenciar permiss√µes de usu√°rios'
};

// Fun√ß√£o para verificar se o usu√°rio tem uma permiss√£o espec√≠fica
export const hasPermission = (userPermissions, permission) => {
  if (!userPermissions || !Array.isArray(userPermissions)) {
    return false;
  }
  return userPermissions.includes(permission);
};

// Fun√ß√£o para verificar se o usu√°rio tem todas as permiss√µes de um grupo
export const hasAllPermissions = (userPermissions, permissions) => {
  if (!userPermissions || !Array.isArray(userPermissions)) {
    return false;
  }
  return permissions.every(permission => userPermissions.includes(permission));
};

// Fun√ß√£o para verificar se o usu√°rio tem pelo menos uma permiss√£o de um grupo
export const hasAnyPermission = (userPermissions, permissions) => {
  if (!userPermissions || !Array.isArray(userPermissions)) {
    return false;
  }
  return permissions.some(permission => userPermissions.includes(permission));
};

// Fun√ß√£o para obter permiss√µes por perfil
export const getPermissionsByProfile = (profile) => {
  return DEFAULT_PROFILES[profile]?.permissions || [];
};

// Fun√ß√£o para verificar acesso a menu baseado nas novas permiss√µes
export const canAccessMenu = (userPermissions, menuKey) => {
  const menuPermissions = {
    dashboard: [PERMISSIONS.DASHBOARD_VIEW],
    messages: [PERMISSIONS.MESSAGES_ACCESS],
    btg_accounts: [PERMISSIONS.BTG_ACCESS],
    charges: [PERMISSIONS.CHARGES_ACCESS],
    extracts: [PERMISSIONS.EXTRACTS_ACCESS],
    payroll: [PERMISSIONS.PAYROLL_ACCESS],
    quick_registration: [PERMISSIONS.QUICK_REGISTRATION_ACCESS],
    accounts_management: [PERMISSIONS.ACCOUNTS_MANAGEMENT_ACCESS],
    settings: [PERMISSIONS.SETTINGS_ACCESS],
    users: [PERMISSIONS.USERS_ACCESS]
  };
  
  const requiredPermissions = menuPermissions[menuKey];
  if (!requiredPermissions) return true;
  
  return hasAnyPermission(userPermissions, requiredPermissions);
}; 